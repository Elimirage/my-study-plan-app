# competencies.py

# ============================================================
# 1. Компетенции по профилям (ФГОС)
# ============================================================

PROFILE_COMPETENCIES = {
    "ИВТ": {
        "УК": ["УК-1", "УК-2"],
        "ОПК": ["ОПК-1", "ОПК-2", "ОПК-3"],

        # ПК разбиты по тематическим группам
        "ПК_ПРОГРАММИРОВАНИЕ": ["ПК-1", "ПК-2"],
        "ПК_ДАННЫЕ": ["ПК-3", "ПК-5"],
        "ПК_СИСТЕМЫ": ["ПК-4"],
        "ПК_АЛГОРИТМЫ": ["ПК-1", "ПК-3"],
        "ПК_СЕТИ": ["ПК-4"],
        "ПК_ИИ": ["ПК-3", "ПК-5"]
    },

    "ПИ": {
        "УК": ["УК-1", "УК-2"],
        "ОПК": ["ОПК-1", "ОПК-4"],

        "ПК_ПРОГРАММИРОВАНИЕ": ["ПК-1"],
        "ПК_ДАННЫЕ": ["ПК-6"],
        "ПК_СИСТЕМЫ": ["ПК-7"],
        "ПК_АЛГОРИТМЫ": ["ПК-6"],
        "ПК_СЕТИ": ["ПК-8"],
        "ПК_ИИ": ["ПК-6", "ПК-7"]
    },

    "ПИнг": {
        "УК": ["УК-1", "УК-2"],
        "ОПК": ["ОПК-1", "ОПК-5"],

        "ПК_ПРОГРАММИРОВАНИЕ": ["ПК-1", "ПК-2"],
        "ПК_ДАННЫЕ": ["ПК-3"],
        "ПК_СИСТЕМЫ": ["ПК-9"],
        "ПК_АЛГОРИТМЫ": ["ПК-2"],
        "ПК_СЕТИ": ["ПК-9"],
        "ПК_ИИ": ["ПК-3"]
    }
}

# ============================================================
# 2. Ключевые слова дисциплин → тематические группы ПК
# ============================================================

DISCIPLINE_KEYWORDS = {
    # Математика, теория
    "матем": ["УК", "ОПК", "ПК_АЛГОРИТМЫ"],
    "теория": ["УК", "ОПК", "ПК_АЛГОРИТМЫ"],
    "вероят": ["УК", "ОПК", "ПК_ДАННЫЕ"],
    "статист": ["УК", "ОПК", "ПК_ДАННЫЕ"],

    # Программирование
    "программ": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],
    "python": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],
    "java": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],
    "c++": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],
    "логическ": ["УК", "ОПК", "ПК_АЛГОРИТМЫ"],

    # Алгоритмы, структуры данных
    "алгоритм": ["УК", "ОПК", "ПК_АЛГОРИТМЫ"],
    "структур": ["УК", "ОПК", "ПК_АЛГОРИТМЫ"],
    "граф": ["УК", "ОПК", "ПК_АЛГОРИТМЫ"],

    # Данные, базы данных
    "данн": ["УК", "ОПК", "ПК_ДАННЫЕ"],
    "баз": ["УК", "ОПК", "ПК_ДАННЫЕ"],
    "sql": ["УК", "ОПК", "ПК_ДАННЫЕ"],

    # Искусственный интеллект, ML
    "машин": ["УК", "ОПК", "ПК_ИИ"],
    "нейрон": ["УК", "ОПК", "ПК_ИИ"],
    "интеллект": ["УК", "ОПК", "ПК_ИИ"],
    "рекоменд": ["УК", "ОПК", "ПК_ИИ"],

    # Системы, архитектура, ОС
    "систем": ["УК", "ОПК", "ПК_СИСТЕМЫ"],
    "архитектур": ["УК", "ОПК", "ПК_СИСТЕМЫ"],
    "операцион": ["УК", "ОПК", "ПК_СИСТЕМЫ"],

    # Сети, распределённые системы
    "сет": ["УК", "ОПК", "ПК_СЕТИ"],
    "распредел": ["УК", "ОПК", "ПК_СЕТИ"],

    # Криптография
    "крипт": ["УК", "ОПК", "ПК_СИСТЕМЫ"],

    # Веб, мобильная разработка
    "веб": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],
    "мобиль": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],
    "кроссплатформ": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],

    # Игры, VR/AR
    "игр": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],
    "виртуаль": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],
    "дополненн": ["УК", "ОПК", "ПК_ПРОГРАММИРОВАНИЕ"],

    # Облака
    "облач": ["УК", "ОПК", "ПК_СИСТЕМЫ"],

    # NLP
    "естествен": ["УК", "ОПК", "ПК_ИИ"],
    "язык": ["УК", "ОПК", "ПК_ИИ"],
    "перевод": ["УК", "ОПК", "ПК_ИИ"],
}

# ============================================================
# 3. Основная функция
# ============================================================

def detect_competencies(profile: str, discipline: str):
    profile_data = PROFILE_COMPETENCIES.get(profile)
    if not profile_data:
        return "УК-1, ОПК-2"

    discipline_lower = discipline.lower()
    result = set()

    # ищем ключевые слова
    for keyword, comp_groups in DISCIPLINE_KEYWORDS.items():
        if keyword in discipline_lower:
            for group in comp_groups:
                result.update(profile_data.get(group, []))

    # если ничего не найдено — базовый набор
    if not result:
        result.update(profile_data["УК"])
        result.update(profile_data["ОПК"])

    return ", ".join(sorted(result))
