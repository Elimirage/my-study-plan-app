# competencies.py

"""
Матрица соответствия: профиль → дисциплина → список компетенций.

Сейчас заполнен профиль "ИВТ" (ФГОС ВО 3++ 09.03.01 ИВТ, ред. 2020/2021)
с детализированными профессиональными компетенциями ПК-1 ... ПК-20.

Структура расширяема: для других профилей (ПИ, ПИнг и т.п.) достаточно
добавить новые ключи верхнего уровня в COMPETENCY_MATRIX.
"""

# Универсальные компетенции (для справки, в логике не используются)
UNIVERSAL_COMPETENCIES = [
    "УК-1", "УК-2", "УК-3", "УК-4", "УК-5", "УК-6", "УК-7", "УК-8"
]

# Общепрофессиональные компетенции (для справки)
GENERAL_PROFESSIONAL_COMPETENCIES = [
    "ОПК-1", "ОПК-2", "ОПК-3"
]

# Профессиональные компетенции профиля ИВТ (детализированные, А1)
# (для справки; при необходимости можно использовать в интерфейсе или отчётах)
PROFESSIONAL_COMPETENCIES_IVT = {
    "ПК-1":  "Основы программирования",
    "ПК-2":  "Объектно-ориентированное программирование",
    "ПК-3":  "Алгоритмы и структуры данных",
    "ПК-4":  "Теория вычислений и формальных языков",
    "ПК-5":  "Архитектура вычислительных систем",
    "ПК-6":  "Операционные системы",
    "ПК-7":  "Сетевые технологии",
    "ПК-8":  "SQL и реляционные базы данных",
    "ПК-9":  "NoSQL и распределенные хранилища",
    "ПК-10": "Машинное обучение",
    "ПК-11": "Нейронные сети и глубокое обучение",
    "ПК-12": "Компьютерное зрение и графика",
    "ПК-13": "Большие данные (Big Data) и распределенные вычисления",
    "ПК-14": "Кибербезопасность и технологии блокчейн",
    "ПК-15": "Веб-разработка (frontend/backend)",
    "ПК-16": "Мобильная разработка",
    "ПК-17": "VR/AR-технологии",
    "ПК-18": "Интернет вещей (IoT)",
    "ПК-19": "Робототехника и киберфизические системы",
    "ПК-20": "Проектирование информационных систем",
}


# ---------------------------------------------------------
# БАЗОВЫЕ НАБОРЫ ДЛЯ УДОБСТВА
# ---------------------------------------------------------

ALL_UK = ["УК-1","УК-2","УК-3","УК-4","УК-5","УК-6","УК-7","УК-8"]

def uk_opk(*opk_codes):
    """
    Удобная сборка: все УК + выбранные ОПК.
    """
    return ALL_UK + list(opk_codes)

def uk_only():
    """
    Только универсальные компетенции (для практик, ГИА и т.п., если нужно).
    """
    return ALL_UK.copy()


# ---------------------------------------------------------
# МАТРИЦА ДЛЯ ПРОФИЛЯ "ИВТ"
# ---------------------------------------------------------

IVT_DISCIPLINE_COMPETENCIES = {

    # ===== 1 семестр =====
    "Математический анализ": (
        uk_opk("ОПК-1", "ОПК-2") + ["ПК-3"]
    ),

    "Операционные системы": (
        uk_opk("ОПК-2", "ОПК-3") + ["ПК-6", "ПК-5"]
    ),

    # ===== 2 семестр =====
    "Дискретная математика": (
        uk_opk("ОПК-1") + ["ПК-3", "ПК-4"]
    ),

    "Базы данных": (
        uk_opk("ОПК-2", "ОПК-3") + ["ПК-8", "ПК-9"]
    ),

    # ===== 3 семестр =====
    "Теория вероятностей и математическая статистика": (
        uk_opk("ОПК-1") + ["ПК-10", "ПК-13"]
    ),

    "Теория информации": (
        uk_opk("ОПК-1") + ["ПК-3", "ПК-4"]
    ),

    "Разработка мобильных приложений": (
        uk_opk("ОПК-2") + ["ПК-16"]
    ),

    "Компьютерная графика": (
        uk_opk("ОПК-2") + ["ПК-12"]
    ),

    "Обработка естественного языка": (
        uk_opk("ОПК-2") + ["ПК-10", "ПК-11"]
    ),

    "Технологии больших данных (Big Data)": (
        uk_opk("ОПК-2") + ["ПК-13"]
    ),

    "Проектирование информационных систем": (
        uk_opk("ОПК-3") + ["ПК-20"]
    ),

    "Разработка чат-ботов": (
        uk_opk("ОПК-2") + ["ПК-10", "ПК-11"]
    ),

    "Технологии виртуальной реальности в образовании": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    "Разработка приложений для виртуальной реальности в медицине": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    "Технологии блокчейн в логистике": (
        uk_opk("ОПК-2") + ["ПК-14"]
    ),

    "Разработка приложений для умных транспортных средств": (
        uk_opk("ОПК-2") + ["ПК-18"]
    ),

    # ===== 4 семестр =====
    "Алгоритмы и структуры данных": (
        uk_opk("ОПК-1") + ["ПК-3"]
    ),

    "Теория автоматов и формальных языков": (
        uk_opk("ОПК-1") + ["ПК-4"]
    ),

    "Веб-программирование": (
        uk_opk("ОПК-2") + ["ПК-15"]
    ),

    "Системное программирование": (
        uk_opk("ОПК-2") + ["ПК-6", "ПК-5"]
    ),

    "Робототехника": (
        uk_opk("ОПК-2") + ["ПК-19"]
    ),

    "Машинное обучение": (
        uk_opk("ОПК-2") + ["ПК-10", "ПК-11"]
    ),

    "Управление проектами в IT": (
        uk_opk("ОПК-3")
    ),

    "Технологии блокчейн в IT": (
        uk_opk("ОПК-2") + ["ПК-14"]
    ),

    "Разработка приложений для виртуальной реальности": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    "Технологии блокчейн в государственном управлении": (
        uk_opk("ОПК-2") + ["ПК-14"]
    ),

    "Разработка приложений для умных домов": (
        uk_opk("ОПК-2") + ["ПК-18"]
    ),

    # ===== 5 семестр =====
    "Языки программирования": (
        uk_opk("ОПК-2") + ["ПК-1", "ПК-2"]
    ),

    "Математическая логика": (
        uk_opk("ОПК-1") + ["ПК-4"]
    ),

    "Технологии искусственного интеллекта": (
        uk_opk("ОПК-2") + ["ПК-10", "ПК-11"]
    ),

    "Технологии виртуальной реальности": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    "Интернет вещей (IoT)": (
        uk_opk("ОПК-2") + ["ПК-18"]
    ),

    "Нейронные сети": (
        uk_opk("ОПК-2") + ["ПК-11"]
    ),

    "Технологии облачных вычислений": (
        uk_opk("ОПК-2") + ["ПК-13"]
    ),

    "Разработка мобильных игр": (
        uk_opk("ОПК-2") + ["ПК-16", "ПК-12"]
    ),

    "Технологии блокчейн в финансах": (
        uk_opk("ОПК-2") + ["ПК-14"]
    ),

    "Разработка приложений для умных городов": (
        uk_opk("ОПК-2") + ["ПК-18"]
    ),

    "Технологии виртуальной реальности в культуре": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    # ===== 6 семестр =====
    "Архитектура вычислительных систем": (
        uk_opk("ОПК-2") + ["ПК-5"]
    ),

    "Теория графов": (
        uk_opk("ОПК-1") + ["ПК-3"]
    ),

    "Распределённые вычисления": (
        uk_opk("ОПК-2") + ["ПК-13", "ПК-9"]
    ),

    "Разработка игр": (
        uk_opk("ОПК-2") + ["ПК-12", "ПК-16"]
    ),

    "Блокчейн и криптовалюты": (
        uk_opk("ОПК-2") + ["ПК-14"]
    ),

    "Системы управления базами данных": (
        uk_opk("ОПК-2", "ОПК-3") + ["ПК-8", "ПК-9"]
    ),

    "Разработка кроссплатформенных приложений": (
        uk_opk("ОПК-2") + ["ПК-16"]
    ),

    "Технологии интернета вещей в промышленности": (
        uk_opk("ОПК-2") + ["ПК-18"]
    ),

    "Разработка приложений для интернета вещей": (
        uk_opk("ОПК-2") + ["ПК-18"]
    ),

    "Технологии виртуальной реальности в туризме": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    "Разработка приложений для виртуальной реальности в культуре": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    # ===== 7 семестр =====
    "Параллельное программирование": (
        uk_opk("ОПК-2") + ["ПК-13", "ПК-3"]
    ),

    "Компьютерное зрение": (
        uk_opk("ОПК-2") + ["ПК-12"]
    ),

    "Кибербезопасность": (
        uk_opk("ОПК-2") + ["ПК-14"]
    ),

    "Администрирование баз данных": (
        uk_opk("ОПК-2", "ОПК-3") + ["ПК-8", "ПК-9"]
    ),

    "Технологии дополненной реальности": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    "Разработка приложений для умных устройств": (
        uk_opk("ОПК-2") + ["ПК-18"]
    ),

    "Технологии виртуальной реальности в медицине": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    "Разработка приложений для виртуальной реальности в туризме": (
        uk_opk("ОПК-2") + ["ПК-17"]
    ),

    "Технологии блокчейн в медиа": (
        uk_opk("ОПК-2") + ["ПК-14"]
    ),

    # ===== Практики и ГИА (минимальный набор УК, при желании можно усилить) =====
    "Учебная практика": uk_only(),
    "Преддипломная практика": uk_only(),
    "ВКР": uk_only(),
}


# ---------------------------------------------------------
# ОБЩАЯ МАТРИЦА ПО ПРОФИЛЯМ
# ---------------------------------------------------------

COMPETENCY_MATRIX = {
    "ИВТ": IVT_DISCIPLINE_COMPETENCIES,
    # сюда позже можно добавить "ПИ": {...}, "ПИнг": {...} и т.д.
}


# ---------------------------------------------------------
# ГЛАВНАЯ ФУНКЦИЯ ДЛЯ ТВОЕГО ПАЙПЛАЙНА
# ---------------------------------------------------------

FALLBACK_COMPETENCIES = uk_opk("ОПК-1", "ОПК-2")

def detect_competencies(profile: str, discipline_name: str) -> list:
    """
    Возвращает список компетенций для заданного профиля и названия дисциплины.

    Логика:
    - если профиль есть в COMPETENCY_MATRIX и дисциплина найдена по точному совпадению —
      возвращаем заранее заданный список компетенций;
    - иначе возвращаем fallback: УК-1…УК-8 + ОПК-1, ОПК-2.

    Это гарантирует стабильное поведение даже при новых/нестандартных названиях дисциплин.
    """
    profile_matrix = COMPETENCY_MATRIX.get(profile)
    if profile_matrix is None:
        return FALLBACK_COMPETENCIES.copy()

    comps = profile_matrix.get(discipline_name)
    if comps is None:
        return FALLBACK_COMPETENCIES.copy()

    return list(comps)  # возврат копии, чтобы снаружи ничего не портили
